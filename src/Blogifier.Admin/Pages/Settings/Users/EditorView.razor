@page "/admin/settings/user/{Id:int?}"

@layout SettingsLayout

@inject HttpClient _http
@inject NavigationManager _navigation
@inject IStringLocalizer<Resource> _localizer
@inject IMapper _mapper
@inject IToaster _toaster

<h1 class="section-title">@_localizer["add-user"]</h1>
<div class="section-content -half">
  <EditForm Model="@User" OnValidSubmit="Save">
    <DataAnnotationsValidator />
    <div class="form-item">
      <label class="form-label">@_localizer["email"]</label>
      <input class="form-control" type="email" @bind="User.Email" />
      <ValidationMessage For="@(() => User.Email)"></ValidationMessage>
    </div>
    <div class="form-item">
      <label class="form-label">@_localizer["user-name"]</label>
      <input class="form-control" tyoe="text" @bind="User.UserName" />
      <ValidationMessage For="@(() => User.UserName)"></ValidationMessage>
    </div>
    <div class="form-item">
      <label class="form-label">@_localizer["nick-name"]</label>
      <input class="form-control" type="text" @bind="User.NickName" />
      <ValidationMessage For="@(() => User.NickName)"></ValidationMessage>
    </div>
    <div class="form-item">
      <label class="form-label">@_localizer["user-bio"]</label>
      <textarea class="form-control" rows="3" @bind="User.Bio" />
    </div>
    <div class="form-item">
      <button type="submit" class="btn btn-blogifier px-5 me-3">@_localizer["save"]</button>
      <button type="button" @onclick="Cancel" class="btn btn-default px-4">@_localizer["cancel"]</button>
    </div>
  </EditForm>
</div>

@code{

  [Parameter] public int? Id { get; set; }

  protected UserInfoDto User { get; set; } = new UserInfoDto();

  protected async Task Save()
  {
    Toast(await _http.PutAsJsonAsync("api/category", User));
    Cancel();
  }

  protected void Cancel()
  {
    _navigation.NavigateTo("/admin/blogs/category");
  }

  protected void Toast(HttpResponseMessage msg)
  {
    if (msg.IsSuccessStatusCode)
      _toaster.Success(_localizer["completed"]);
    else
      _toaster.Error(_localizer["generic-error"]);
  }
}
